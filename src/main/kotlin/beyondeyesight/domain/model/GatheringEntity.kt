package beyondeyesight.domain.model

import jakarta.persistence.Column
import jakarta.persistence.Entity
import jakarta.persistence.EnumType
import jakarta.persistence.Enumerated
import jakarta.persistence.Table
import java.time.LocalDateTime
import java.util.UUID

@Entity
@Table(name = "gatherings")
class GatheringEntity(
    uuid: UUID,
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    val applyType: ApplyType,
    @Column(nullable = false)
    val minCapacity: Int,
    @Column(nullable = false)
    val maxCapacity: Int,
    @Column(nullable = false)
    val genderRatioEnabled: Boolean,
    @Column(nullable = false)
    val minAge: Int,
    @Column(nullable = false)
    val maxAge: Int,
    @Column(nullable = true)
    val maxMaleCount: Int?,
    @Column(nullable = true)
    val maxFemaleCount: Int?,
    @Column(nullable = true)
    var currentMaleCount: Int?,
    @Column(nullable = true)
    var currentFemaleCount: Int?,
    @Column(nullable = false)
    val totalAttendees: Int,
    @Column(nullable = false)
    val fee: Int,
    @Column(nullable = false)
    val discountEnabled: Boolean,
    @Column(nullable = false)
    val offline: Boolean,
    @Column(nullable = false)
    val place: String,
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    val category: Category,
    @Column(nullable = false)
    val subCategory: String,
    @Column(nullable = false)
    @Enumerated(EnumType.STRING)
    var status: Status,
    @Column(nullable = false)
    val imageUrl: String,
    @Column(nullable = false)
    val title: String,
    @Column(nullable = false)
    val introduction: String,
    @Column(nullable = false)
    var clickCount: Int,
    @Column(nullable = false)
    val startDateTime: LocalDateTime,
): BaseEntity(uuid = uuid) {

    fun close() {
        this.status = Status.CLOSED
    }

    companion object {
        fun open(
            applyType: ApplyType,
            minCapacity: Int,
            maxCapacity: Int,
            genderRatioEnabled: Boolean,
            minAge: Int,
            maxAge: Int,
            maxMaleCount: Int?,
            maxFemaleCount: Int?,
            currentMaleCount: Int?,
            currentFemaleCount: Int?,
            totalAttendees: Int,
            fee: Int,
            discountEnabled: Boolean,
            offline: Boolean,
            place: String,
            category: Category,
            subCategory: String,
            status: Status,
            imageUrl: String,
            title: String,
            introduction: String,
            clickCount: Int,
            startDateTime: LocalDateTime,
        ): GatheringEntity {
            return GatheringEntity(
                uuid = UUID.randomUUID(),
                applyType = applyType,
                minCapacity = minCapacity,
                maxCapacity = maxCapacity,
                genderRatioEnabled = genderRatioEnabled,
                minAge = minAge,
                maxAge = maxAge,
                maxMaleCount = maxMaleCount,
                maxFemaleCount = maxFemaleCount,
                currentMaleCount = currentMaleCount,
                currentFemaleCount = currentFemaleCount,
                totalAttendees = totalAttendees,
                fee = fee,
                discountEnabled = discountEnabled,
                offline = offline,
                place = place,
                category = category,
                subCategory = subCategory,
                status = status,
                imageUrl = imageUrl,
                title = title,
                introduction = introduction,
                clickCount = clickCount,
                startDateTime = startDateTime
            )
        }
    }

    enum class ApplyType {
        FIRST_IN,
        APPROVAL
    }

    enum class Category {
        PARTY,
        FOOD_DRINK,
        STUDY,
        INVEST,
        LANGUAGE,
        ACTIVITY,
        CULTURE,
        LOVE
    }

    enum class Status {
        OPEN, CLOSED, CANCELLED
    }
}